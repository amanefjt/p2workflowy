# p2workflowy (Paper to Workflowy)

**長い英語の論文や書籍をAIで解析・要約・翻訳し、Workflowyに直接貼り付け可能な形式に変換するツール**

学術論文やレポート、書籍などの長いテキストを、Gemini AIを使って意味のある階層構造に整理（構造化）し、専門用語辞書を活用した正確な日本語翻訳を行います。出力は [WorkFlowy](https://workflowy.com/) にそのままペーストできる形式（階層付きテキスト）で行われるため、構造化された情報を効率的に管理・閲覧できます。

---

## 🚀 はじめに

このツールは **Google Gemini API** の無料枠を活用して動作します。

### 🔑 Gemini APIキーについて
本ツールを利用するには、ご自身で [Google AI Studio](https://aistudio.google.com/) から APIキーを取得する必要があります。

- **取得方法**: Google AI Studio にログインし、「Get API key」から発行できます。
- **支払い登録**: Google側の仕様により、無料枠の利用であっても、プロジェクトの作成や APIキーの取得にクレジットカード等の支払い手段の登録が求められる場合があります。
- **プライバシー**: 入力した APIキーは、あなたの環境（ブラウザやローカルファイル）にのみ保存されます。ツールの開発者や外部に送信されることはありません。

### ⚠️ 学習への利用に関する注意
**Gemini API の「無料枠」を使用する場合、入力したデータや出力結果は、Googleのモデル改善のための学習に利用される可能性があります。**
機密性の高い文書、未発表の研究資料、個人情報を含むドキュメントなどを扱う際は、十分にご注意ください。学習を回避するには、Google Cloud の有料プラン（Vertex AI等）の検討が必要ですが、本ツールは現在 AI Studio の API に最適化されています。

---

## 🎯 主な機能

### 1. **論文モード (Paper Mode)**
数十ページ程度の学術論文に最適化されたモードです。
- 全体の要約を先に作成し、それをガイドにして本文を並列で高速に翻訳します。
- 論文の構造（Introduction, Methods, Results等）を自動認識してWorkflowy形式に変換します。

### 2. **書籍モード (Book Mode)**
100ページを超えるような本格的な書籍の処理に対応した新機能です。
- 全体の構成と目次を分析した後、章（Chapter）ごとに文脈を維持しながら、要約と翻訳を段階的に行います。
- Gemini 3 Flash Preview の 1M コンテキストウィンドウを最大限に活用し、一貫性のある処理を実現します。
- **⚠️ 注意**: 書籍モードは現在、開発中のβ版のため、出力の構造や精度がやや不安定な場合があります。大まかな内容把握にご利用ください。

### 3. **アカデミック翻訳 & 専門用語辞書**
専門用語辞書（`glossary.csv`）を読み込ませることで、特定の分野に特有の用語を常に一定の訳語で翻訳できます。

### 4. **構造復元 (Cognitive Structuring)**
PDFからコピー＆ペーストした際などに発生するテキストの崩れ（段落の断片化など）をAIが自動修復し、論理的な Markdown 構造に復元します。

---

## 🛠 処理パイプライン (Processing Pipeline)

本ツールは精緻な構造化と要約を実現するため、以下のステップで段階的に処理を行います。

```mermaid
graph TD
    Input[入力テキスト (.txt)] --> Mode{モード選択}
    
    subgraph "論文モード (Paper Mode)"
    Mode --> P1[Phase 1: 原文要約]
    P1 --> P2[Phase 2: 構造復元<br/>要約をヒントに構造を再構築]
    P2 --> P3[Phase 3: 並列翻訳<br/>セクション単位で高精度に翻訳]
    P3 --> P4[Phase 4: 成果物統合]
    end
    
    subgraph "書籍モード (Book Mode)"
    Mode --> B1[Phase 1: 全体レジュメ & 目次抽出]
    B1 --> B2[Phase 2: 章分割]
    B2 --> B3[Phase 3: 章ごとの順次処理]
    
    subgraph "章内処理 (Hybrid Parallelism)"
    B3 --> B3S[1. 章レジュメ生成]
    B3S --> B3SP[2. 節(Section)分割]
    B3SP --> B3T[3. 各節の並列処理<br/>(構造化 + 翻訳)]
    B3T --> B3C[4. 章統合]
    end
    
    B3C --> B4[Phase 4: 全体統合]
    end
    
    P4 --> OUT([Workflowy形式出力])
    B4 --> OUT
```

---

## 📦 インストールと実行

### サービス提供形態
- **Web版**: ブラウザで手軽に利用できます（`web/` ディレクトリ配下）。
- **Python版**: 大量・一括処理や、PDFからの直接テキスト抽出が必要なユーザー向け（`src/` ディレクトリ配下）。

### Web版のクイックスタート
1. `web` フォルダに移動
2. `npm install` (依存パッケージのインストール)
3. `npm run dev` (開発サーバーの起動)
4. ブラウザで `localhost:5173` を開く

### Python版のクイックスタート
1. 依存関係のインストール: `pip install -r requirements.txt`
2. `.env` ファイルを作成し `GEMINI_API_KEY=あなたのキー` を設定
3. 実行: `python -m src.main`
   - 起動後、モードを選択してください: `1` (論文モード) または `2` (書籍モード)

---

## 📁 ディレクトリ構造

```
p2workflowy/
├── src/                    # Python版ソースコード（CLI/PDF処理）
├── web/                    # Web版ソースコード（React/Vite）
├── shared/                 # Python/Web共通のプロンプト定義
├── intermediate/           # 中間ファイル保存用
├── output/                 # 最終成果物の出力先
├── glossary.csv           # 専門用語辞書（自分で編集可能）
└── requirements.txt       # Python依存パッケージ
```

---

## 📄 ライセンス

MIT License

**開発者**: [あなたの名前/チーム名]
**リポジトリ**: [リポジトリURL]
